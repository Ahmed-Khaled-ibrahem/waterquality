#include <Wire.h>
#include <LiquidCrystal_I2C.h>

// LCD address and size
LiquidCrystal_I2C lcd(0x27, 16, 2);

const int relayPin = 8;
const int forceSensorPin = A0;
int forceThreshold = 50;

unsigned long startTime = 0;
bool reading = false;

void setup() {
  pinMode(relayPin, OUTPUT);
  digitalWrite(relayPin, LOW);
  lcd.init();
  lcd.backlight();
  lcd.setCursor(0, 0);
  lcd.print("Ready");
  Serial.begin(9600);
}

void loop() {
  int forceValue = analogRead(forceSensorPin);
  Serial.println(forceValue);
  lcd.setCursor(0, 1);
  lcd.print(forceValue);
  lcd.print("  ");


  if (forceValue > forceThreshold) {
    if (!reading) {
      reading = true;
      startTime = millis();
      lcd.clear();
    }

    digitalWrite(relayPin, HIGH);

    unsigned long elapsed = (millis() - startTime) / 1000;
    int minutes = elapsed / 60;
    int seconds = elapsed % 60;

    lcd.setCursor(0, 0);
    lcd.print("Reading");
    lcd.print(forceValue);
    lcd.setCursor(0, 1);
    lcd.print(minutes);
    lcd.print(" m  ");
    lcd.print(seconds);
    lcd.print(" s    ");

    if (elapsed >= 300) {
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print("Take a break !");
      lcd.setCursor(0, 1);
      lcd.print("");
    }

  } else {
    reading = false;
    digitalWrite(relayPin, LOW);
    lcd.clear();
    lcd.setCursor(0, 0);
    lcd.print("Ready :)");
  }

  delay(1000);
}
